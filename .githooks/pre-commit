#!/usr/bin/env bash
# GUARD (versioned): protect bootstrap/bin/* and scripts/bootstrap_gh.sh unless ALLOW_BOOTSTRAP_SOT_CHANGE=1
set -euo pipefail
[ "${ALLOW_BOOTSTRAP_SOT_CHANGE:-0}" = "1" ] && exit 0
CHANGES="$(git diff --cached --name-status || true)"
BAD="$(printf "%s\n" "$CHANGES" | awk '($2 ~ /^bootstrap\/bin\// || $2=="scripts/bootstrap_gh.sh") && ($1=="D"||$1=="M"||$1=="R") {print}')"
if [ -n "$BAD" ]; then
  echo "ERROR: Protected files changed:"; echo "$BAD"
  echo "Set ALLOW_BOOTSTRAP_SOT_CHANGE=1 to override intentionally."; exit 1
fi
exit 0
