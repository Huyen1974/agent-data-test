<html><head><meta charset='utf-8'><title>RTM</title>
<style>body{font-family:sans-serif} table{border-collapse:collapse} td,th{border:1px solid #ccc;padding:4px}</style></head><body>
<h1>Requirements Traceability Matrix</h1>
<table>
<tr><th>ID</th><th>Title</th><th>Doc Cite</th><th>Acceptance</th><th>Refs in Code</th></tr>
<tr><td>ART.1</td><td>**Cấu trúc Phong bì Tin nhắn (Message Envelope v2.2 - BẮT BUỘC):** (Bổ sung resource_links, context_id, và quy định encryption cho payload sensitive.)</td><td>MD:docs/agent-a2a-constitution-v5.md#L31</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.10</td><td>**(Bổ sung)** Nếu một tin nhắn bị xử lý sau khi ttl_sec đã hết hạn, Agent phải từ chối và trả về lỗi EXPIRED. Nếu vượt quota, trả lỗi RATE_LIMIT_EXCEEDED.</td><td>MD:docs/agent-a2a-constitution-v5.md#L99</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.11</td><td>**Quy tắc Vận chuyển &amp; Tải lớn (Transport &amp; Large Payloads):** (Tinh chỉnh chính sách Signed URL siết chặt.)</td><td>MD:docs/agent-a2a-constitution-v5.md#L101</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.12</td><td>**(Tinh chỉnh)** Nếu payload quá lớn, artifact_uri bắt buộc phải là một GCS Signed URL **chỉ cho phép đọc (GET-only)**, có **TTL ≤ 15 phút**, đi kèm với artifact_hash (SHA-256), MIME whitelist, fixed bucket, no-list.</td><td>MD:docs/agent-a2a-constitution-v5.md#L111</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.13</td><td>**Mô hình Kiến trúc:** (Tinh chỉnh) Áp dụng mẫu thiết kế **Saga**, được hiện thực hóa bằng **Google Cloud Workflows** hoặc các framework điều phối đa-agent như **LangChain CrewAI** (multi-agent teams, MCP streamable May 8 2025) hoặc Langroid MAP (delegation Sep 2025).</td><td>MD:docs/agent-a2a-constitution-v5.md#L125</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.14</td><td>**Hệ thống Agent Chuyên biệt:** (Giữ nguyên từ v3.0) Process Agent, Data Agent, Verifier Agent, Notifier Agent.</td><td>MD:docs/agent-a2a-constitution-v5.md#L127</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.15</td><td>**Hợp đồng Bằng chứng Xác minh (Verifier Artifact Contract):** (Giữ nguyên từ v3.0) Verifier Agent khi tạo bằng chứng phải trả về đối tượng có cấu trúc: { &quot;artifact_uri&quot;, &quot;artifact_hash&quot;, &quot;content_type&quot;, &quot;evidence_ts&quot;, &quot;source_kind&quot; }.</td><td>MD:docs/agent-a2a-constitution-v5.md#L129</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.16</td><td>**Xác thực Agent-to-Agent (A2A):** (Tinh chỉnh) principal trong Message Envelope phải được xác thực qua Google Cloud IAM hoặc JWT. Các client bên ngoài phải tuân thủ các tiêu chuẩn bảo mật nâng cao như **OAuth 2.0 Resource Indicators (RFC 8707)** (MCP Jun 18 2025 chống malicious).</td><td>MD:docs/agent-a2a-constitution-v5.md#L135</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.17</td><td>Thông điệp từ external agents BẮT BUỘC phải kèm chữ ký JWS (thuật toán Ed25519/EdDSA); header phải có kid (key ID) và chính sách luân chuyển khóa là 90 ngày. Các yêu cầu có thuật toán không nằm trong danh sách cho phép sẽ bị từ chối..</td><td>MD:docs/agent-a2a-constitution-v5.md#L139</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.18</td><td>Mã nguồn mẫu cho một Saga đơn giản trên Google Cloud Workflows (tích hợp LangChain CrewAI).</td><td>MD:docs/agent-a2a-constitution-v5.md#L260</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.2</td><td>**Máy trạng thái &amp; Quy tắc Phản hồi (State Machine &amp; Response - Tinh chỉnh):** (Bổ sung các trạng thái và quy tắc hủy tác vụ đầy đủ.)</td><td>MD:docs/agent-a2a-constitution-v5.md#L83</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.3</td><td>**Máy trạng thái:** Một tác vụ sẽ đi qua các trạng thái: ACKED → RUNNING → (SUCCEEDED | FAILED) → (COMPENSATED? | CANCELLED?).</td><td>MD:docs/agent-a2a-constitution-v5.md#L85</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.4</td><td>**Phản hồi:**</td><td>MD:docs/agent-a2a-constitution-v5.md#L87</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.5</td><td>**Đồng bộ (&lt;2s):** Trả về SUCCEEDED hoặc FAILED.</td><td>MD:docs/agent-a2a-constitution-v5.md#L89</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.6</td><td>**Bất đồng bộ:** Trả về ACKED, sau đó phát các sự kiện *.running, *.done.</td><td>MD:docs/agent-a2a-constitution-v5.md#L91</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.7</td><td>**Hủy tác vụ:** Một Agent có thể gửi một hành động *.cancel. Nếu tác vụ đang ở trạng thái RUNNING, nó sẽ chuyển sang CANCELLED và kích hoạt hành động bù trừ (compensation) nếu cần; semantics at-least-once, đích MUST dedupe theo idempotency_key và bỏ qua out-of-order nếu seq &lt; last_seq_seen.</td><td>MD:docs/agent-a2a-constitution-v5.md#L93</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.8</td><td>**Phân loại Lỗi &amp; TTL (Error Taxonomy &amp; TTL):** (Bổ sung mã lỗi EXPIRED và RATE_LIMIT_EXCEEDED.)</td><td>MD:docs/agent-a2a-constitution-v5.md#L95</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ART.9</td><td>(Giữ nguyên từ v3.0) Mã lỗi chuẩn: UNAUTHORIZED (401), FORBIDDEN (403), NOT_FOUND (404)...</td><td>MD:docs/agent-a2a-constitution-v5.md#L97</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ASY.1</td><td>**Nguyên tắc Mở rộng và Bền bỉ (Scalability &amp; Resilience):** (Tinh chỉnh từ v3.0) Hệ thống phải được thiết kế để xử lý hàng trăm Agent và quy trình đồng thời, với cơ chế tự phục hồi (retry, DLQ) và phân tải, đồng thời tận dụng mã nguồn hiện có từ các framework như LangChain CrewAI (multi-agent teams, MCP streamable May 8 2025) hoặc Langroid MAP (delegation Sep 2025) để giảm thiểu viết mã mới.</td><td>MD:docs/agent-a2a-constitution-v5.md#L19</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ASY.10</td><td>(Bổ sung các thuật ngữ mới như A2A, ACP, OAS, MCP, Saga, DLQ, SLOs...)</td><td>MD:docs/agent-a2a-constitution-v5.md#L268</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ASY.2</td><td>**Tiêu chuẩn Áp dụng:** (Tinh chỉnh từ v3.0) Nền tảng là **OpenAI Function Calling**, được thực thi thông qua một **Message Envelope** chuẩn hóa, hybrid với MCP structured output (Jun 18 2025) để hỗ trợ tool results/resource links.</td><td>MD:docs/agent-a2a-constitution-v5.md#L25</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ASY.3</td><td>payload.schema_version MUST map tới một JSON Schema trong repo schemas/…; CI BLOCK nếu payload không validate. SDK TS/Python MUST be generated từ OpenAPI/JSON-Schema; không merge nếu SDK không đồng bộ.</td><td>MD:docs/agent-a2a-constitution-v5.md#L29</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ASY.4</td><td>**Hàng đợi &amp; DLQ:** (Giữ nguyên từ v3.0) Bắt buộc có DLQ, retry 6 lần với exponential backoff + jitter; DLQ redrive thủ công với audit (dùng tool TD-APP-02).</td><td>MD:docs/agent-a2a-constitution-v5.md#L147</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ASY.5</td><td>**Giám sát &amp; Truy vết (Trace &amp; Observability):** (Bổ sung metric retry.)</td><td>MD:docs/agent-a2a-constitution-v5.md#L149</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ASY.6</td><td>(Giữ nguyên từ v3.0) trace_id phải được truyền suốt.</td><td>MD:docs/agent-a2a-constitution-v5.md#L151</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ASY.7</td><td>**(Bổ sung)** Metrics bắt buộc: a2a_requests_total, a2a_latency_ms, a2a_dlq_total, a2a_retries_total (với nhãn: action, tenant, principal, status, error.code); monitor quota points MCP advanced (Jun 18 2025).</td><td>MD:docs/agent-a2a-constitution-v5.md#L153</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ASY.8</td><td>SLOs tối thiểu: ACK P95 ≤ 1s, Job-done P95 ≤ ETA + 60s, DLQ/ngày ≤ 0.1%.</td><td>MD:docs/agent-a2a-constitution-v5.md#L155</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ASY.9</td><td>**Bảng thuật ngữ:**</td><td>MD:docs/agent-a2a-constitution-v5.md#L266</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.1</td><td>Envelope field &#x27;version&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L37</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.10</td><td>Envelope field &#x27;ttl_sec&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L55</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.11</td><td>Envelope field &#x27;idempotency_key&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L57</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.12</td><td>Envelope field &#x27;seq&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L59</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.13</td><td>Envelope field &#x27;action&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L61</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.14</td><td>Envelope field &#x27;action_version&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L63</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.15</td><td>Envelope field &#x27;context_id&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L65</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.16</td><td>Envelope field &#x27;resource_links&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L67</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.17</td><td>Envelope field &#x27;payload&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L69</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.18</td><td>Envelope field &#x27;schema_version&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L71</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.2</td><td>Envelope field &#x27;request_id&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L39</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.3</td><td>Envelope field &#x27;correlation_id&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L41</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.4</td><td>Envelope field &#x27;causation_id&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L43</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.5</td><td>Envelope field &#x27;trace_id&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L45</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.6</td><td>Envelope field &#x27;tenant_id&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L47</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.7</td><td>Envelope field &#x27;data_locality&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L49</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.8</td><td>Envelope field &#x27;principal&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L51</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ENV.9</td><td>Envelope field &#x27;timestamp&#x27; present and validated</td><td>MD:docs/agent-a2a-constitution-v5.md#L53</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>ERQ.1</td><td>**Giới hạn Tần suất (Rate Limiting):** (Tinh chỉnh) Ngoài các header X-RateLimit-*, các Agent xử lý qua Pub/Sub cũng phải có cơ chế enforce quota dựa trên principal và tenant_id; đồng bộ trả X-RateLimit-Limit / X-RateLimit-Remaining / Retry-After; bất đồng bộ trả event lỗi nếu vượt.</td><td>MD:docs/agent-a2a-constitution-v5.md#L145</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>REG.1</td><td>*Heartbeat: Mỗi agent BẮT BUỘC phải gửi một tin nhắn heartbeat đến Registry theo chu kỳ (ví dụ: 5 phút/lần). Registry sẽ lưu lại last_seen_at và có thể đánh dấu agent là degraded nếu không nhận được heartbeat, cho phép các Process Agent có thể chủ động giảm tải hoặc định tuyến lại các tác vụ. *</td><td>MD:docs/agent-a2a-constitution-v5.md#L160</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>REG.10</td><td>Multi-agent E2E Test: Mô phỏng một quy trình hoàn chỉnh (ví dụ: Codex → Process Agent → Data Agent → Verifier Agent) và đo lường SLOs (P95 ≤1s ACK).</td><td>MD:docs/agent-a2a-constitution-v5.md#L184</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>REG.2</td><td>**Các Service Chuẩn hóa:** (Bổ sung action_version.)</td><td>MD:docs/agent-a2a-constitution-v5.md#L162</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>REG.3</td><td>(Giữ nguyên từ v3.0) /healthz, /readyz, /evidence/{job_id}.</td><td>MD:docs/agent-a2a-constitution-v5.md#L164</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>REG.4</td><td>**(Tinh chỉnh)** /mcp/capabilities: Công bố envelope_versions, danh sách actions (kèm action_version và max_payload_bytes), và transports; thêm /acp/capabilities cho merger ACP-A2A.</td><td>MD:docs/agent-a2a-constitution-v5.md#L166</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>REG.5</td><td>Agent Data duy trì registry liệt kê actions, action_version, transports, max_payload_bytes của từng agent; /mcp/capabilities MUST khớp registry (CI so khớp).</td><td>MD:docs/agent-a2a-constitution-v5.md#L170</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>REG.6</td><td>Bộ Kiểm thử Hợp chuẩn (Conformance Test Suite):** (Bổ sung các bài test mới.)</td><td>MD:docs/agent-a2a-constitution-v5.md#L176</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>REG.7</td><td>Envelope Validation, Idempotency Test, Error Handling Test, Security Test, Large-payload Test, Out-of-order Test, TTL Test, Evidence Test.</td><td>MD:docs/agent-a2a-constitution-v5.md#L178</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>REG.8</td><td>Version-negotiation Test: Client gửi một action_version không được hỗ trợ và phải nhận về lỗi INVALID_ARGUMENT + gợi ý phiên bản.</td><td>MD:docs/agent-a2a-constitution-v5.md#L180</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>REG.9</td><td>Cancel/Compensation Test: Gửi yêu cầu hủy khi tác vụ đang chạy và xác nhận nhận được sự kiện *.cancelled hoặc *.compensated.</td><td>MD:docs/agent-a2a-constitution-v5.md#L182</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>TRN.1</td><td>**Nguyên tắc Tương thích Mở (Interoperability First):** (Tinh chỉnh từ v3.0) Hệ thống ưu tiên áp dụng các giao thức mở được cộng đồng công nhận (ví dụ: MCP của Anthropic với cập nhật security và structured output Jun 18 2025, A2A/Google với toolkit secure enterprise Jul 31 2025, ACP/IBM merger với A2A dưới LF AI Aug 29 2025, OAS/HuggingFace cho open collab MMORPG AI NPC) và theo dõi các xu hướng hợp nhất tiêu chuẩn (ví dụ: sự hợp nhất của A2A/Google và ACP/IBM dưới LF AI) để đảm bảo khả năng tương tác rộng rãi, tận dụng adapter hiện có như Langroid MCP adapter v0.53.0 (Apr 2025) và LangChain MCP streamable HTTP (May 8 2025).</td><td>MD:docs/agent-a2a-constitution-v5.md#L7</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>TRN.10</td><td>Tài liệu về A2A/ACP (LF AI) - Merger Aug 29 2025 (IBM contribute BeeAI open-source).</td><td>MD:docs/agent-a2a-constitution-v5.md#L198</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>TRN.11</td><td>Tài liệu về OpenAI Function Calling.</td><td>MD:docs/agent-a2a-constitution-v5.md#L200</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>TRN.12</td><td>Tài liệu về OAS/HuggingFace (MMORPG AI NPC, SmolAgents code-based 2025).</td><td>MD:docs/agent-a2a-constitution-v5.md#L202</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>TRN.13</td><td>**Ví dụ Mã nguồn:**</td><td>MD:docs/agent-a2a-constitution-v5.md#L204</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>TRN.14</td><td>Mã nguồn mẫu cho Langroid ToolMessage triển khai Message Envelope v2.2 (hybrid MCP/A2A, adapter Apr 2025).</td><td>MD:docs/agent-a2a-constitution-v5.md#L206</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>TRN.2</td><td>**Nguyên tắc Chuẩn hóa Giao thức (Standardized Protocol):** (Giữ nguyên từ v3.0) Mọi giao tiếp trực tiếp giữa các Agent phải tuân thủ một giao thức chung, có cấu trúc.</td><td>MD:docs/agent-a2a-constitution-v5.md#L9</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>TRN.3</td><td>**Nguyên tắc Chuyên môn hóa (Specialization):** (Giữ nguyên từ v3.0) Mỗi Agent được thiết kế để giải quyết một nhóm vấn đề cụ thể và chỉ làm tốt nhất việc đó.</td><td>MD:docs/agent-a2a-constitution-v5.md#L11</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>TRN.4</td><td>**Nguyên tắc Bất đồng bộ (Asynchronous-First):** (Giữ nguyên từ v3.0) Giao tiếp qua hàng đợi tin nhắn (Message Queue) như Pub/Sub là phương thức được ưu tiên.</td><td>MD:docs/agent-a2a-constitution-v5.md#L13</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>TRN.5</td><td>**Nguyên tắc Idempotency:** (Giữ nguyên từ v3.0) Mọi hành động làm thay đổi trạng thái phải được thiết kế để có thể thực thi lại nhiều lần mà không gây ra kết quả ngoài ý muốn.</td><td>MD:docs/agent-a2a-constitution-v5.md#L15</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>TRN.6</td><td>**Nguyên tắc Xác minh Độc lập (Independent Verification):** (Giữ nguyên từ v3.0) Một Agent không được coi là hoàn thành nhiệm vụ chỉ dựa trên lời xác nhận của Agent khác; nó phải tự mình xác minh kết quả cuối cùng.</td><td>MD:docs/agent-a2a-constitution-v5.md#L17</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>TRN.7</td><td>(Giữ nguyên từ v3.0) Hỗ trợ 2 kênh: HTTP và Pub/Sub.</td><td>MD:docs/agent-a2a-constitution-v5.md#L105</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>TRN.8</td><td>**Liên kết đến các Tiêu chuẩn:**</td><td>MD:docs/agent-a2a-constitution-v5.md#L194</td><td>README.md</td><td>&nbsp;</td></tr>
<tr><td>TRN.9</td><td>Tài liệu về MCP (Anthropic) - Changelog Jun 18 2025: security (OAuth Resource Servers, RFC 8707), structured output (tool results/resource links), elicitation (request info).</td><td>MD:docs/agent-a2a-constitution-v5.md#L196</td><td>README.md</td><td>&nbsp;</td></tr>
</table>
</body></html>
