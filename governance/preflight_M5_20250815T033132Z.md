# M5 Preflight — Secrets & Permissions

## Metadata
- **Repository:** Huyen1974/agent-data-test
- **Branch:** main
- **Generated:** 20250815T033132Z
- **Script Version:** M5.PRE-CLI-01

## Executive Summary
❌ **FAIL** - 2 issue(s) found that must be resolved

## Referenced Secrets in Workflows
- `GCP_PROJECT_ID`
- `GCP_SA_KEY_JSON`
- `GCP_SERVICE_ACCOUNT`
- `GCP_WIF_POOL`
- `GCP_WIF_PROVIDER`
- `GITHUB_TOKEN`
- `OPENAI_API_KEY`
- `QDRANT_CLOUD_MGMT_KEY`
- `QDRANT_CLUSTER1_ID`
- `QDRANT_CLUSTER1_KEY`
- `SLACK_WEBHOOK_URL`

## Missing Secrets
These secrets are referenced in workflows but not found in repository or environments:
- ❌ `GITHUB_TOKEN`
- ❌ `SLACK_WEBHOOK_URL`

## Referenced Variables (vars.*)
_No variables referenced in workflows_

## Missing Variables
These variables are referenced in workflows but not found in repository:
_No missing variables_

## Cloud OIDC Authentication Workflows
- `.github/workflows/lint-only.yml`
- `.github/workflows/lint-only.yml.bak`
- `.github/workflows/secrets-audit.yml.bak`
- `.github/workflows/sync-secrets.yml.bak`

### Workflows Missing Required Permissions
These workflows use cloud authentication but lack 'permissions: id-token: write':
- ❌ `.github/workflows/secrets-audit.yml.bak`
- ❌ `.github/workflows/sync-secrets.yml.bak`

## Repository Workflow Permissions
- **Default workflow permissions:** `read`

## Key CI/CD Health Check
Status of critical workflows (latest run):
- **wif-gsm-smoke.yml:** `no-data`
- **sync-secrets.yml:** `completed/failure`
- **security-verify.yml:** `no-data`

## Recommendations
### Missing Secrets
1. Add the following secrets to your repository settings:
   - GITHUB_TOKEN
   - SLACK_WEBHOOK_URL
2. Verify secrets are available in appropriate environments if using environment protection rules

### Missing OIDC Permissions
1. Add the following permissions block to workflows:
   ```yaml
   permissions:
     id-token: write
     contents: read
   ```
2. Update the following workflow files:
   - .github/workflows/secrets-audit.yml.bak
   - .github/workflows/sync-secrets.yml.bak

## Compliance Notes
- This preflight check ensures compliance with M5.PRE-CLI-01 requirements
- Validates secrets and permissions before Terraform/WIF deployment
- Evidence-based validation with idempotent execution
- Report committed only when all checks pass

## Technical Details
- **Script:** `scripts/m5_preflight_secrets_permissions.sh`
- **Execution time:** `Fri Aug 15 03:31:38 UTC 2025`
- **Repository URL:** `https://github.com/Huyen1974/agent-data-test`
- **Commit SHA:** `1367c8d58ae5d5d14f15bc9b56c7ae1e28b3a6a7`
